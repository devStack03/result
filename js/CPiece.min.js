function CPiece(t,e,i,n,r,o,a,s,l,T,c){var u,_,I,O,N,h,f,g,J,p,y,d,x,P,E,F,A,H,w;this._init=function(t,e,i,n,r,o,a,s,l,T){if(_=!1,I=!1,O=!1,N=a,f=r,h=0,ENABLE_ROT_PIECE){var c=Math.floor(Math.random()*PIECE_ROTATIONS.length);h=PIECE_ROTATIONS[c]}E=o,p=new Array,(A=new createjs.Container).x=t+i/2,A.y=e+n/2,A.regX=i/2,A.regY=n/2,A.cursor="pointer",H.addChild(A),y={x:A.x,y:A.y};var u=createBitmap(s);(F=createSprite(T,"frame_"+N,0,0,i,n)).filters=[new createjs.AlphaMaskFilter(u.image)],F.cache(0,0,i,n),A.addChild(F);var J=createBitmap(l);A.addChild(J),this._initHitAreas(),(g=new Array).push(A.on("mousedown",this._onPieceDown)),g.push(A.on("pressmove",this._onDragPiece)),g.push(A.on("pressup",this._onReleasePiece))},this.unload=function(){A.off("mousedown",g[0]),A.off("pressmove",g[1]),A.off("pressup",g[2])},this.reset=function(t){if(A.alpha=1,I=!1,t){var e=Math.floor(Math.random()*PIECE_ROTATIONS.length);h=PIECE_ROTATIONS[e]}else h=0;this._initHitAreas(),p=new Array,this.moveTo(d)},this._initHitAreas=function(){if(u=f*f,J=new Array,null!==E.up){var t=E.up[0];(i=new createjs.Shape).graphics.beginFill("rgba(255,0,0,0.3)").drawCircle(t,E.up[1],f),J[JOINT_UP]={x:t,y:E.up[1],pointer:i}}else J[JOINT_UP]=null;if(null!==E.right){var e=E.right[1];(i=new createjs.Shape).graphics.beginFill("rgba(0,255,0,0.3)").drawCircle(E.right[0],e,f),J[JOINT_RIGHT]={x:E.right[0],y:e,pointer:i}}else J[JOINT_RIGHT]=null;if(null!==E.down){t=E.down[0];(i=new createjs.Shape).graphics.beginFill("rgba(0,0,255,0.3)").drawCircle(t,E.down[1],f),J[JOINT_DOWN]={x:t,y:E.down[1],pointer:i}}else J[JOINT_DOWN]=null;if(null!==E.left){var i;e=E.left[1];(i=new createjs.Shape).graphics.beginFill("rgba(255,228,0,0.7)").drawCircle(E.left[0],e,f),J[JOINT_LEFT]={x:E.left[0],y:e,pointer:i}}else J[JOINT_LEFT]=null},this.moveTo=function(t){d=t,createjs.Tween.get(A).to({x:t.x,y:t.y,rotation:h},1e3,createjs.Ease.cubicOut).call((function(){_=!0,s_oInterface.enableGUI(!0)}))},this.setStartingPosition=function(){A.x=y.x,A.y=y.y,_=!1},this.resetStartingPosition=function(){y={x:A.x,y:A.y}},this.setRotation=function(t){I||(A.rotation=t?h:0)},this.fadeOut=function(){createjs.Tween.get(A).to({alpha:0},TIME_FADE_OUT_PIECES)},this.snap=function(t,e){return A.x=y.x+t,A.y=y.y+e,p},this.checkCollision=function(t){console.log("here");var e=this._updateHitAreaPosition();return null!==t[JOINT_UP]&&null!==e[JOINT_DOWN]&&distance2(t[JOINT_UP],e[JOINT_DOWN])<u?{joint1:e[JOINT_DOWN].pointer,joint2:t[JOINT_UP].pointer,dir:JOINT_UP}:null!==t[JOINT_RIGHT]&&null!==e[JOINT_LEFT]&&distance2(t[JOINT_RIGHT],e[JOINT_LEFT])<u?{joint1:e[JOINT_LEFT].pointer,joint2:t[JOINT_RIGHT].pointer,dir:JOINT_RIGHT}:null!==t[JOINT_DOWN]&&null!==e[JOINT_UP]&&distance2(t[JOINT_DOWN],e[JOINT_UP])<u?{joint1:e[JOINT_UP].pointer,joint2:t[JOINT_DOWN].pointer,dir:JOINT_DOWN}:null!==t[JOINT_LEFT]&&null!==e[JOINT_RIGHT]&&distance2(t[JOINT_LEFT],e[JOINT_RIGHT])<u?{joint1:e[JOINT_RIGHT].pointer,joint2:t[JOINT_LEFT].pointer,dir:JOINT_LEFT}:null},this._updateHitAreaPosition=function(){var t=new Array;return null!==J[JOINT_UP]?t[JOINT_UP]={x:A.x-A.regX+J[JOINT_UP].x,y:A.y-A.regY+J[JOINT_UP].y,pointer:J[JOINT_UP].pointer}:t[JOINT_UP]=null,null!==J[JOINT_RIGHT]?t[JOINT_RIGHT]={x:A.x-A.regX+J[JOINT_RIGHT].x,y:A.y-A.regY+J[JOINT_RIGHT].y,pointer:J[JOINT_RIGHT].pointer}:t[JOINT_RIGHT]=null,null!==J[JOINT_DOWN]?t[JOINT_DOWN]={x:A.x-A.regX+J[JOINT_DOWN].x,y:A.y-A.regY+J[JOINT_DOWN].y,pointer:J[JOINT_DOWN].pointer}:t[JOINT_DOWN]=null,null!==J[JOINT_LEFT]?t[JOINT_LEFT]={x:A.x-A.regX+J[JOINT_LEFT].x,y:A.y-A.regY+J[JOINT_LEFT].y,pointer:J[JOINT_LEFT].pointer}:t[JOINT_LEFT]=null,t},this.removeJoint=function(t){for(var e in J)if(null!==J[e]&&J[e].pointer===t){A.removeChild(J[e].pointer),J[e]=null;break}},this.getContainer=function(){return A},this.getLogicCircleHitArea=function(){return J},this.setAttached=function(t){I=t},this.updateJointList=function(t){p=t},this.setDepth=function(t){H.setChildIndex(A,t)},this._onPieceDown=function(t){_&&(x={x:t.stageX/s_iScaleFactor-A.x,y:t.stageY/s_iScaleFactor-A.y},P={x:t.stageX/s_iScaleFactor,y:t.stageY/s_iScaleFactor})},this._onDragPiece=function(t){if(_&&void 0!==P&&!(distance({x:t.stageX/s_iScaleFactor,y:t.stageY/s_iScaleFactor},P)<10)){var e=t.stageX/s_iScaleFactor-x.x,i=t.stageY/s_iScaleFactor-x.y;e<s_iOffsetX||e>CANVAS_WIDTH-s_iOffsetX||i<s_iOffsetY||i>CANVAS_HEIGHT-s_iOffsetY||(O=!0,A.x=e,A.y=i,s_oGame.draggingPiece(A.x,A.y,w,p))}},this.draggedByOtherPiece=function(t,e,i){A.x=t+i.x,A.y=e+i.y},this._onReleasePiece=function(){if(_)if(O){O=!1;var t=w._updateHitAreaPosition();s_oGame.releasePiece(w,t)}else!I&&s_oInterface.isRotationActive()&&(A.rotation+=45)},this.getHitAreas=function(){return J},this.getJoint=function(t){return J[t].pointer},this.getX=function(){return A.x},this.getY=function(){return A.y},this.getDiffX=function(){return A.x-y.x},this.getDiffY=function(){return A.y-y.y},this.getStartingX=function(){return y.x},this.getStartingY=function(){return y.y},this.getStartingPos=function(){return y},this.getPos=function(){return{x:A.x,y:A.y}},this.isAttached=function(){return I},this.getIndex=function(){return N},this.getAbsRotation=function(){return A.rotation%360==0?0:A.rotation},w=this,H=c,this._init(t,e,i,n,r,o,a,s,l,T)}