function CMain(e){var r,i,s,t,a=0,o=0,n=STATE_LOADING;this.initContainer=function(){s_oCanvas=document.getElementById("canvas"),s_oStage=new createjs.Stage(s_oCanvas),createjs.Touch.enable(s_oStage,!0),!1===(s_bMobile=jQuery.browser.mobile)&&(s_oStage.enableMouseOver(20),s_bMobile=isMobile()),s_iPrevTime=(new Date).getTime(),createjs.Ticker.addEventListener("tick",this._update),createjs.Ticker.framerate=FPS,navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0),s_oSpriteLibrary=new CSpriteLibrary,s=new CPreloader},this.preloaderReady=function(){s_oMain._loadImages(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_oMain._initSounds()},this.soundLoaded=function(){a++;var e=Math.floor(a/o*100);s.refreshLoader(e)},this._initSounds=function(){Howler.mute(!s_bAudioActive),(s_aSoundsInfo=new Array).push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"}),s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"}),s_aSoundsInfo.push({path:"./sounds/",filename:"snap",loop:!1,volume:1,ingamename:"snap"}),s_aSoundsInfo.push({path:"./sounds/",filename:"place",loop:!1,volume:1,ingamename:"place"}),o+=s_aSoundsInfo.length,s_aSounds=new Array;for(var e=0;e<s_aSoundsInfo.length;e++)this.tryToLoadSound(s_aSoundsInfo[e],!1)},this.tryToLoadSound=function(e,r){setTimeout((function(){s_aSounds[e.ingamename]=new Howl({src:[e.path+e.filename+".mp3"],autoplay:!1,preload:!0,loop:e.loop,volume:e.volume,onload:s_oMain.soundLoaded,onloaderror:function(e,r){for(var i=0;i<s_aSoundsInfo.length;i++)if(e===s_aSounds[s_aSoundsInfo[i].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[i],!0);break}},onplayerror:function(e){for(var r=0;r<s_aSoundsInfo.length;r++)if(e===s_aSounds[s_aSoundsInfo[r].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[r].ingamename].once("unlock",(function(){s_aSounds[s_aSoundsInfo[r].ingamename].play(),"soundtrack"===s_aSoundsInfo[r].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)}));break}}})}),r?200:0)},this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png"),s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png"),s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png"),s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png"),s_oSpriteLibrary.addSprite("but_lang","./sprites/change_lang.png"),s_oSpriteLibrary.addSprite("extra_logo","./sprites/extra.png"),s_oSpriteLibrary.addSprite("snickers_logo","./sprites/snickers.png"),s_oSpriteLibrary.addSprite("products_en","./sprites/products-en.png"),s_oSpriteLibrary.addSprite("products_ar","./sprites/products-ar.png"),s_oSpriteLibrary.addSprite("menu_text_ar","./sprites/menu_text_ar.png"),s_oSpriteLibrary.addSprite("menu_text_en","./sprites/menu_text_en.png"),s_oSpriteLibrary.addSprite("time_bg","./sprites/time.png"),s_oSpriteLibrary.addSprite("take_charge_en","./sprites/take_charge_en.png"),s_oSpriteLibrary.addSprite("take_charge_ar","./sprites/take_charge_ar.png"),s_oSpriteLibrary.addSprite("bg_menu","./sprites/menu_bg.png"),s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.png"),s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png"),s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png"),s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png"),s_oSpriteLibrary.addSprite("frame","./sprites/frame.png"),s_oSpriteLibrary.addSprite("button_grp","./sprites/button_group.png"),s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png"),s_oSpriteLibrary.addSprite("but_preview","./sprites/but_preview.png"),s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png"),s_oSpriteLibrary.addSprite("but_level_en","./sprites/but_level_en.png"),s_oSpriteLibrary.addSprite("but_level_ar","./sprites/but_level_ar.png"),s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png"),s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png"),s_oSpriteLibrary.addSprite("but_yes_en","./sprites/but_yes_en.png"),s_oSpriteLibrary.addSprite("but_yes_ar","./sprites/but_yes_ar.png"),s_oSpriteLibrary.addSprite("but_submit_en","./sprites/but_submit_en.png"),s_oSpriteLibrary.addSprite("but_submit_ar","./sprites/but_submit_ar.png"),s_oSpriteLibrary.addSprite("but_no_en","./sprites/but_no_en.png"),s_oSpriteLibrary.addSprite("but_no_ar","./sprites/but_no_ar.png"),s_oSpriteLibrary.addSprite("form_panel_en","./sprites/form_panel_en.png"),s_oSpriteLibrary.addSprite("form_panel_ar","./sprites/form_panel_ar.png"),s_oSpriteLibrary.addSprite("completed_en","./sprites/completed_en.png"),s_oSpriteLibrary.addSprite("completed_ar","./sprites/completed_ar.png"),s_oSpriteLibrary.addSprite("are_you_sure_en","./sprites/are_you_sure_en.png"),s_oSpriteLibrary.addSprite("are_you_sure_ar","./sprites/are_you_sure_ar.png"),s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png"),s_oSpriteLibrary.addSprite("toggle_rotation","./sprites/toggle_rotation.png");for(var e=1;e<NUM_IMAGES+1;e++)s_oSpriteLibrary.addSprite("image_"+e,"./sprites/image_"+e+".jpg");for(var r=0;r<4;r++)s_oSpriteLibrary.addSprite("difficulty_"+r,"./sprites/difficulty_"+r+".png");for(r=0;r<DIFFICULTY.length;r++)for(var i=0;i<DIFFICULTY[r];i++)s_oSpriteLibrary.addSprite("piece_"+i+"of"+DIFFICULTY[r],"./sprites/difficulty_"+r+"/piece_"+i+".png"),s_oSpriteLibrary.addSprite("effect_piece_"+i+"of"+DIFFICULTY[r],"./sprites/difficulty_"+r+"/effect_piece_"+i+".png");o+=s_oSpriteLibrary.getNumSprites(),s_oSpriteLibrary.loadSprites()},this._onImagesLoaded=function(){a++;var e=Math.floor(a/o*100);s.refreshLoader(e)},this._allResourcesLoaded=function(){s.unload(),s_oMain.gotoMenu(),s_oGameSettings=new CGameSettings},this._onAllImagesLoaded=function(){},this.onAllPreloaderImagesLoaded=function(){this._loadImages()},this.gotoMenu=function(){ORIENTATION="portrait",CANVAS_WIDTH=1080,CANVAS_HEIGHT=1920,s_oCanvas.width=1080,s_oCanvas.height=1920,new CMenu,n=STATE_MENU,sizeHandler()},this.gotoChooseImage=function(){ORIENTATION="portrait",CANVAS_WIDTH=1080,CANVAS_HEIGHT=1920,s_oCanvas.width=1080,s_oCanvas.height=1920,new CChooseImagePanel,n=STATE_CHOOSE_IMAGE,sizeHandler()},this.gotoChooseDifficulty=function(){ORIENTATION="landscape",CANVAS_HEIGHT=1080,CANVAS_WIDTH=1920,s_oCanvas.width=1920,s_oCanvas.height=1080,new CChooseDifficultyPanel,n=STATE_CHOOSE_DIFFICULTY,sizeHandler()},this.gotoGame=function(e){ORIENTATION="landscape",CANVAS_HEIGHT=1080,CANVAS_WIDTH=1920,s_oCanvas.width=1920,s_oCanvas.height=1080,t=new CGame(e,i),n=STATE_GAME,sizeHandler()},this.startGame=function(){s_szImageSelected="image_1",t=new CGame(0,i),n=STATE_GAME},this.gotoHelp=function(){new CHelp,n=STATE_HELP},this.gotoForm=function(e){ORIENTATION="portrait",CANVAS_WIDTH=1080,CANVAS_HEIGHT=1920,s_oCanvas.width=1080,s_oCanvas.height=1920,sizeHandler(),_oForm=new CForm(e),n=STATE_FORM},this.stopUpdate=function(){r=!1,createjs.Ticker.paused=!0,$("#block_game").css("display","block"),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)},this.startUpdate=function(){s_iPrevTime=(new Date).getTime(),r=!0,createjs.Ticker.paused=!1,$("#block_game").css("display","none"),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_bAudioActive&&Howler.mute(!1)},this._update=function(e){if(!1!==r){var i=(new Date).getTime();s_iTimeElaps=i-s_iPrevTime,s_iCntFps++,s_iPrevTime=i,(s_iCntTime+=s_iTimeElaps)>=1e3&&(s_iCurFps=s_iCntFps,s_iCntTime-=1e3,s_iCntFps=0),n===STATE_GAME&&t.update(),s_oStage.update(e)}},s_oMain=this,i=e,NUM_IMAGES=e.num_images,ENABLE_FULLSCREEN=e.fullscreen,ENABLE_CHECK_ORIENTATION=e.check_orientation,s_bAudioActive=e.audio_enable_on_startup,ENABLE_ROT_PIECE=!0,ENABLE_PREVIEW=e.enable_preview,this.initContainer()}var s_bMobile,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_oGameSettings,s_szImageSelected,s_aSounds,s_aSoundsInfo,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_bFullscreen=!1;